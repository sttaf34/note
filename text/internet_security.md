
# 参考URL
https://sehermitage.web.fc2.com/
https://qiita.com/angel_p_57/
https://qiita.com/t_nakayama0714/items/83ac0b12ced9e7083927

# インターネット上のリスク

## 盗聴
- ECサイトで買い物をする時に入力したクレカの番号を第三者に見られる。

## なりすまし
- 何らかの手段で他人のパスワードを入手、他人を偽り認証しサービスを利用する。

## 改ざん
- データを別のデータに書き換える。

## 事後否認
- 注文した記録が残っているのに、「注文していない！」と否認すること。

# 公開鍵暗号
- 暗号化用の鍵（公開鍵）と復号用の鍵（秘密鍵）を用意する。
- 平文を公開鍵で暗号文に変換できる。
- 暗号文を秘密鍵で平文に変換できる。
- 大事なのは、秘密鍵を持っている人だけが、暗号文を復号して読めるということ。
- 秘密鍵を持っていない第三者はデータを復号できないので、盗聴を防ぐ手段となる。

# 共通鍵暗号
- https://ja.wikipedia.org/wiki/共通鍵暗号
- 暗号化と復号に同一の（共通の）鍵を用いる暗号方式。
- 鍵を持っていない第三者はデータを復号できないので、盗聴を防ぐ手段となる。
- 短所としては、第三者に鍵が渡ってしまうとバレバレになるということ。
- なので、鍵をなるべく安全に受け渡したい、その方法の一つがDH法。

# 鍵交換・DH法
- https://ja.wikipedia.org/wiki/ディフィー・ヘルマン鍵共有
- AさんとBさんが、互いに鍵ペアを持っていて、秘密裏に情報を共有したい。
- AさんとBさんとで、互いの公開鍵を交換する。
- Aさんは、自分の秘密鍵とBさんの公開鍵とで、「ある計算」をする。
- Bさんは、自分の秘密鍵とAさんの公開鍵とで、「ある計算」をする。
- 互いの「ある計算」の結果は同じになる。それを共通鍵暗号方式の鍵として使う。
- 「ある計算」は Wikipedia に書いてある。

# メッセージ認証コード・MAC (Message Authentication Code)
- AさんはBさんにデータを安全に送信したい。
- 鍵交換はすでに完了していて、互いが共通鍵を持っている。
- Aさんは、データを共通鍵で暗号化する。
- Aさんは、その暗号文と共通鍵からハッシュを計算する。これをMACと呼ぶ。
- Aさんは、Bさんにその暗号文とMACを送信する。
- Bさんは、受け取った暗号文と共通鍵からハッシュを計算し、MACを得る。
- Bさんが自分で計算したMACと、受信したMACが同じなら、改ざんはないということ。
- 改ざんを防ぐ手段となる。

# デジタル署名・RSA署名
- https://qiita.com/angel_p_57/items/437ca6235defc938b97d
- Aさんは秘密鍵（署名鍵）と公開鍵（検証鍵）を持っている。
- AさんはBさんに署名付きのデータを送信しようとしている。
- Aさんはデータから「ある計算by秘密鍵」をする、計算結果が署名となる。
- Bさんはデータと署名を受信し「ある計算by公開鍵」をすることで署名を検証する。
- 署名の検証がOKであれば、データ改ざんはない等のことが言える。
- ある計算 -> https://sehermitage.web.fc2.com/cmath/sign_alg.html

- ネット上でよく見られる「秘密鍵で暗号化」との記述には注意とのこと。
- とても詳しい -> https://qiita.com/angel_p_57/items/437ca6235defc938b97d

# ハイブリッド暗号
- Aさんは、Bさんにデータを送信しようとしている。
- Aさんは、共通鍵を作成し、データを暗号化する。暗号文となる。
- Aさんは、その共通鍵をBさんの公開鍵で暗号化する。
- Aさんは、暗号文と暗号化共通鍵をBさんに送信する。
- Bさんは、受信した暗号化共通鍵を自身の秘密鍵で復号する。
- Bさんは、受信した暗号文を復号した共通鍵で復号する。データが得られる。

# 中間者攻撃

## 中間者がいない場合
- Aさんは、Bさんに公開鍵暗号を使ってデータを送信しようとしている。
- Aさんは、Bさんの公開鍵を用いてデータを暗号化し、Bさんに送信する。
- Bさんは、受信したデータを自身の秘密鍵で複合し、データを得る。

## 中間者がいる場合
- https://ja.wikipedia.org/wiki/中間者攻撃
- Aさんは、Bさんに公開鍵暗号を使ってデータを送信しようとしている。
- Aさんは、Bさんの公開鍵を入手しようと試みる。
- が！攻撃者が間に入り、Aさんが入手したのは攻撃者の公開鍵だった。
- Aさんとしては、Bさんの公開鍵で暗号化してデータを送信しているつもり。
- 実際は、攻撃者の公開鍵で暗号化しているので、攻撃者は復号化しデータを得られる。

# デジタル証明書

## 認証局とは
- https://ja.wikipedia.org/wiki/認証局
- 証明書を発行してくれる組織

## クライアントが予め持っている認証局の公開鍵
- Mac であればキーチェーンでいろいろ見れる。

## 自サイトにSSLサーバ証明書を置いて、クライアントからアクセスする場合

### 事前準備
- 証明書を発行してもらうために、認証局に証明書要求を提出する。
- 認証局は審査の後、証明書を発行してくれる。その証明書をサーバ上に設置する。
- その証明書は、認証局の秘密鍵でデジタル署名されている。

### クライアントからのアクセスとサーバ認証フェーズ
- クライアントがサーバにアクセスすると、サーバは証明書をクライアントに送信する。
- クライアントは、認証局の公開鍵を持っている。キーチェーンで見ることができる。
- クライアントは、認証局の公開鍵を用いて、署名の正当性を検証する。
- 認証局が発行した証明書に改ざんはないと言える。
- 証明書にはドメイン名が書いてある。Aとする。
- クライアントがアクセスしているドメインをBとする。
- AとBが一致しているならば、正しいサーバにアクセスしているとなる。

### 鍵交換フェーズ
- あとでまとめる。
- 共通鍵を公開鍵で暗号化して秘密鍵で復号する的なのは、安全ではない。
- TLS1.3で禁止される
