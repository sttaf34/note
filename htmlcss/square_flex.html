<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<style type="text/css">

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

div.container {
  display: flex;
  justify-content: space-between;
  padding: 10px 10px 0;
}

div.item {
  border: 1px solid gray;
  flex: 1 0 auto;
  height: auto;
  margin-right: 10px;
}
div.right {
  margin-right: 0;
}
div.item:before {
  content: '';
  float: left;
  padding-top: 100%;
}

</style>
</head>
<body>

<div class="container">
  <div class="item">横幅と高さ</div>
  <div class="item">が連動し正</div>
  <div class="item right">方形を維持</div>
</div>
<div class="container">
  <div class="item">中身の大き</div>
  <div class="item">さが一緒で</div>
  <div class="item right">ある必要有</div>
</div>

</body>
</html>
